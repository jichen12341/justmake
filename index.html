<!DOCTYPE html>
<html>
<head>
    <title>Just Make</title>
    <style>
        body { margin: 0; padding-bottom: 3rem; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        #form { background: rgba(0, 0, 0, 0.15); padding: 0.25rem; position: fixed; bottom: 0; left: 0; right: 0; display: flex; height: 3rem; box-sizing: border-box; backdrop-filter: blur(10px); }
        #input { border: 0.05rem; padding: 0 1rem; flex-grow: 1; border-radius: 2rem; margin: 0.25rem; }
        #input:focus { outline: none; }
        #form > button { background: #333; border: none; padding: 0 1rem; margin: 0.25rem; border-radius: 3px; outline: none; color: #fff; }

        #messages { list-style-type: none; margin: 0; padding: 0; }
        #messages > li { padding: 0.5rem 1rem; }
        #messages > li:nth-child(odd) { background: #efefef; }

        #msgDesk { list-style-type: none; margin: 0; padding: 0; }
        
        table.fixed { table-layout:fixed; }
        table.fixed td { overflow: hidden; }
    </style>
    <script src="/socket.io/socket.io.js"></script>
    <script src="client_game.js"></script>
       
</head>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<body>    
    <ul id="panelLogin">
        <input type="text" id="name" value="ttt" placeholder="暱稱" /> 
        <button onclick="join_game()">加入遊戲</button>
        <button onclick="start_game()">開始遊戲</button>   
        <ul id="messages"></ul>
    </ul>
        
    <!-- 第1層table -->
    <table id="table1" class="fixed" align="left" style="width:80%;background-color:green;">
        <tr>
            <td></td>
            <td>
                <li id="lblPlayerName2"></li>
                <li id="lblBid2"></li>
                <li id="lblEat2"></li>
                <label id="lblScore2"></label>
            </td>
            <td></td>
        </tr>
    </table>
    
    <!-- 第2層table -->
    <table id="table2" class="fixed" align="left" style="width:80%;background-color:green;">
        <tr>
            <td></td>
            <td id="deskPanel2" style="width:5%;"></td>
            <td></td>
        </tr>
    </table>
        
    <!-- 第3層table -->
    <table id="table3" class="fixed" align="left" style="width:80%;background-color:green;">
        <tr>
            <td>
                <li id="lblPlayerName1"></li>
                <li id="lblBid1"><li>
                <li id="lblEat1"></li>
            </td>            
            <td id="deskPanel1" style="width:5%;"></td>
            <td id="lblMessage"></td>
            <td id="deskPanel3" style="width:5%;"></td>
            <td>
                <li id="lblPlayerName3"></li>
                <li id="lblBid3"></li>
                <li id="lblEat3"></li>
            </td>        
        </td>
    </table>
    
    <!-- 第4層table -->
    <table id="table4" class="fixed" align="left" style="width:80%;background-color:green;">
        <tr>
            <td></td>            
            <td id="deskPanel0" style="width:5%;"></td>
            <td></td>
        </tr>
    </table>
    
    <!-- 第5層table -->
    <table id="table5" class="fixed" align="left" style="width:80%;background-color:green;">
        <tr>
            <td></td>            
            <td>
                <li id="lblPlayerName0"></li>
                <li id="lblBid0"></li>
                <li id="lblEat0"></li>
                
            </td>
            <td></td>
        </tr>
    </table>
    
    <!-- 第6層table -->
    <table id="table6" class="fixed" align="left" style="width:80%;background-color:green;">
        <tr>
            <td id="handCardsPanel0" style="width:5%"></td>
            <td id="handCardsPanel1" style="width:5%"></td>
            <td id="handCardsPanel2" style="width:5%"></td>
            <td id="handCardsPanel3" style="width:5%"></td>            
            <td id="handCardsPanel4" style="width:5%"></td>
            <td id="handCardsPanel5" style="width:5%"></td>
            <td id="handCardsPanel6" style="width:5%"></td>
            <td id="handCardsPanel7" style="width:5%"></td>
            <td id="handCardsPanel8" style="width:5%"></td>
            <td id="handCardsPanel9" style="width:5%"></td>
            <td id="handCardsPanel10" style="width:5%"></td>
            <td id="handCardsPanel11" style="width:5%"></td>           
            <td id="handCardsPanel12" style="width:5%"></td>    
            <td>
                <div id="bidPanel"></div>
            </td>
        </tr>        
    </table>
    <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    <ul id="panelDesk">
        <ul id="msgDesk"></ul>
        <ul><input type="text" id="txtGuessHands" placeholder="叫幾墩" /><button onclick="guess_hands()">Send</button></ul>        
        <ul><input type="text" id="txtPlayCard" placeholder="出牌" /><button onclick="play_card()">Send</button></ul>
        <ul id="msgDesk2"></ul>
        <ul id="msgRealHands"></ul>
        <ul id="msgDesk3"></ul>
    </ul>   
    
    <script src="client_layout.js"></script> 
    <script>
        var gSocket = io();
        
        function join_game()
        {           
            var name = document.getElementById('name').value;
            if (name)
            {
                gPlayerName = name;
                gSocket.emit('join game', name);
            }            
        }
        
        function start_game()
        {
            gSocket.emit('start game');           
            //document.getElementById("panelLogin").innerHTML = '<object type="text/html" data="index2.html?name="' + gPlayerName + '></object>';
        }       
        
        /////////////////////////////////////////////////////////////////////////////////
        
        // 獲得玩家名字
        gSocket.on('get player names', function(playerNames) {        
            gPlayerNameList = playerNames;
            
            // find player's position
            for (var i = 0; i < MAX_PLAYERS; i++)
            {
                if (playerNames[i] == gPlayerName)
                    gPlayerNo = i;
            }
            
            display_playernames(gPlayerNameList);
        });                        
        
        // 可以發牌了
        gSocket.on('deal cards', function(cards) {        
            deal_cards(cards);
        });  

        // 所有人都叫牌了，進入出牌階段
        gSocket.on('get bid', function(bid) {        
            gBid = bid;
            display_bid_label(gBid);
            add_message(bid);
            start_a_new_turn();
        });
        
        // 有人出了一張牌
        gSocket.on('play a card', function(playerNo, card) {   
            card = parseInt(card);
            display_desk_card(playerNo, card);
            add_message(gPlayerNameList[playerNo] + " 出了 " + card);
            gDeskCards[playerNo] = card;
            gTurn = (gTurn + 1) % MAX_PLAYERS;
            
            // 四個人都出牌了，看誰吃這墩
            if (gTurn == gFirstPlayerNo)
            {
                gTurn = get_next_first_player();
                gFirstPlayerNo = gTurn;
                gEat[gTurn]++;
                document.getElementById("msgRealHands").innerHTML = gEat;
                add_message(gPlayerNameList[gTurn] + "吃了這墩");                
                display_eat(gTurn);         
            }   

            if (gTurn == gPlayerNo)
            {
                gState = STATE_PLAY;
                display_message("換你了");
            }              
        });        

        function add_message(msg)
        {
            var messages = document.getElementById('msgDesk3');
            var item = document.createElement('li');
            item.textContent = msg;
            //messages.appendChild(item);
            console.log(msg);
            //window.scrollTo(0, document.body.scrollHeight);        
        }
    </script>
    
    <script>
    /*
      var socket = io();

      var messages = document.getElementById('messages');
      var form = document.getElementById('form');
      var input = document.getElementById('input');

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (input.value) {
          socket.emit('chat message', input.value);
          input.value = '';
        }
      });

      socket.on('chat message', function(msg) {
        var item = document.createElement('li');
        item.textContent = msg;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
      });
      */
    </script>
</body>
</html>
